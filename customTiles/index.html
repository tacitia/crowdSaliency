<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="author" content="Radu Jianu">
    <meta name="description" content="This Genome Expression Map (GEM) displays differential expression of genes across the mouse genome.">
    <meta name="keywords" content="ImmGen, GEM, Genome Viewer, Immunological Genome, Immunological Genome Project, differential expression map, Google Maps">

    <title>Genome Expression Map</title>

    <style type="text/css">
    v\:* {
      behavior:url(#default#VML);
    }
    body {
	background-image: url(immGenBanner.jpg);
	background-repeat: repeat;
	background-color: #666666;
}
</style>

    
 
    <!--  Create a google map for your domain and paste it after key=    -->
    <script src="http://maps.google.com/maps?file=api&v=2.x&key=ABQIAAAAhVib-l7FWlPaaY1ZVttTzhR-gPp76Gxk0IHrdMbwMgL5_WFPfhRVLzPKRnmbKRctJ6MI_1eqPZIcKw"
            type="text/javascript"></script>
    <script type="text/javascript">

   
    //----------------java script required by genome google maps-------------------

    //general params
    var centreLat=0;
    var centreLon=0;
    var initialZoom=0;
    var imageWraps=false; //SET THIS TO false TO PREVENT THE IMAGE WRAPPING AROUND LIKE THE EARTH SHOULD
    
	var maxZoom = 9;
    var minZoom = 1;
    var tilePath;   
	
    var map; //the GMap2 itself   
   

    /////////////////////////////////////////////////////////////////////////////
    //Projection functions required by Gmaps
    function CustomProjection(a,b){
	this.imageDimension=Math.pow(2,maxZoom);
	this.pixelsPerLonDegree=[];
	this.pixelOrigin=[];
	this.tileBounds=[];
	this.tileSize=512;
    this.isWrapped=b;
	var b=this.tileSize;
	var c=1;
	for(var d=0;d<a;d++){
          var e=b/2;
          this.pixelsPerLonDegree.push(b/360);
          this.pixelOrigin.push(new GPoint(e,e));
          this.tileBounds.push(c);
          b*=2;
          c*=2
        }
    }        
 
    CustomProjection.prototype=new GProjection();
  
    CustomProjection.prototype.fromLatLngToPixel=function(latlng,zoom){
        var c=Math.round(this.pixelOrigin[zoom].x+latlng.lng()*this.pixelsPerLonDegree[zoom]);
        var d=Math.round(this.pixelOrigin[zoom].y+(-2*latlng.lat())*this.pixelsPerLonDegree[zoom]);
        return new GPoint(c,d)
    };

    CustomProjection.prototype.fromPixelToLatLng=function(pixel,zoom,unbounded){
        var d=(pixel.x-this.pixelOrigin[zoom].x)/this.pixelsPerLonDegree[zoom];
        var e=-0.5*(pixel.y-this.pixelOrigin[zoom].y)/this.pixelsPerLonDegree[zoom];
        return new GLatLng(e,d,unbounded)
    };

    CustomProjection.prototype.tileCheckRange=function(tile,zoom,tilesize){
        var tileBounds=this.tileBounds[zoom];
	if (tile.y<0 || tile.y >= tileBounds) {return false;}
        if (this.isWrapped) {
		if (tile.x<0 || tile.x>=tileBounds) { 
			tile.x = tile.x%tileBounds; 
			if (tile.x < 0) {tile.x+=tileBounds} 
		}
	}
	else { 
        	if (tile.x<0 || tile.x>=tileBounds) {return false;}
	}  
  	return true;
    }
      
    CustomProjection.prototype.getWrapWidth=function(zoom) {
	    // large number so markers don't wrap 
	    return 5000000;
    }

   
    ///////////////////////////////////////////////////////////////////////////
    //this function gets a 2D point (x) and a zoom level b
    //and retrieves the appropriate tile
    function customGetTileURL(a,b) {
     //create the zoom substring
      z = "z" + (9-b);
     
     x = "x"+a.x;
     
     y = "y"+ (Math.pow(2,b)-a.y-1);
    
     ret = "./" + z + "-" + x + "-" + y + ".JPG"

     return ret;
    }
    
    ////////////////////////////////////////////////////////////////////////
    //initialize Gmaps

    function getWindowHeight() {
        if (window.self&&self.innerHeight) {
            return self.innerHeight;
        }
        if (document.documentElement&&document.documentElement.clientHeight) {
            return document.documentElement.clientHeight;
        }
        return 0;
    }

	function getWindowWidth() {
        if (window.self&&self.innerWidth) {
            return self.innerWidth;
        }
        if (document.documentElement&&document.documentElement.clientWidth) {
            return document.documentElement.clientWidth;
        }
        return 0;
    }



    function resizeMapDiv() {
        //Resize the height of the div containing the map.
        //Do not call any map methods here as the resize is called before the map is created.
    	var d=document.getElementById("map_cvs");
        var offsetTop=0;
        for (var elem=d; elem!=null; elem=elem.offsetParent) {
            offsetTop+=elem.offsetTop;
        }
        var height=getWindowHeight()-offsetTop-16;
        if (height>=0) {
            d.style.height=height+"px";
        }
    }
    
   

    function load() {
	
      if (GBrowserIsCompatible()) {
        resizeMapDiv();
        var copyright = new GCopyright(1, new GLatLngBounds(new GLatLng(-90, -180), new GLatLng(90, 180)), 0, "");
        var copyrightCollection = new GCopyrightCollection("Radu's CR");
        copyrightCollection.addCopyright(copyright);

        //create a custom picture layer - can make multiple layers
        var pic_tileLayers = [ new GTileLayer(copyrightCollection , minZoom, maxZoom)];
        pic_tileLayers[0].getTileUrl = customGetTileURL;
        pic_tileLayers[0].isPng = function() { return true; };
        pic_tileLayers[0].getOpacity = function() { return 1; };
        var proj=new CustomProjection(9,imageWraps);
        var pic_customMap = new GMapType(pic_tileLayers, proj, "Really really really long title",
            {maxResolution:maxZoom, minResolution:minZoom, tileSize:512, errorMessage:"Data not available"});

        //Now create the custom map. Would normally be G_NORMAL_MAP,G_SATELLITE_MAP,G_HYBRID_MAP
        map = new GMap2(document.getElementById("map_cvs"), {backgroundColor:"#000000", mapTypes:[pic_customMap]});
        map.addControl(new GLargeMapControl3D());
        map.enableDoubleClickZoom();
		map.enableContinuousZoom();
		map.enableScrollWheelZoom();
        map.setCenter(new GLatLng(centreLat, centreLon), initialZoom, pic_customMap);

				
		var sw = map.getBounds().getSouthWest();
		var height = map.fromLatLngToContainerPixel(new GLatLng(sw.lat(), 0)).y;
		var width = getWindowWidth();

		
      }
    }
    
   

    </script>
</head>
  

<body onresize="resizeMapDiv()" onload="load()" onunload="GUnload()"> 

<div id="map_cvs"></div>
	
</body>

</html>